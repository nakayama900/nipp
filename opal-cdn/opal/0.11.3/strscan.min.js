Opal.modules.strscan=function(Opal){function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}var $nesting=(Opal.top,[]),nil=Opal.nil,$klass=(Opal.breaker,Opal.slice,Opal.klass),$send=Opal.send;return Opal.add_stubs(["$attr_reader","$anchor","$scan_until","$length","$size","$rest","$pos=","$-","$private"]),function($base,$super,$parent_nesting){function $StringScanner(){}{var TMP_StringScanner_initialize_1,TMP_StringScanner_beginning_of_line$q_2,TMP_StringScanner_scan_3,TMP_StringScanner_scan_until_4,TMP_StringScanner_$$_5,TMP_StringScanner_check_6,TMP_StringScanner_check_until_7,TMP_StringScanner_peek_8,TMP_StringScanner_eos$q_9,TMP_StringScanner_exist$q_10,TMP_StringScanner_skip_11,TMP_StringScanner_skip_until_12,TMP_StringScanner_get_byte_13,TMP_StringScanner_match$q_14,TMP_StringScanner_pos$eq_15,TMP_StringScanner_matched_size_16,TMP_StringScanner_post_match_17,TMP_StringScanner_pre_match_18,TMP_StringScanner_reset_19,TMP_StringScanner_rest_20,TMP_StringScanner_rest$q_21,TMP_StringScanner_rest_size_22,TMP_StringScanner_terminate_23,TMP_StringScanner_unscan_24,TMP_StringScanner_anchor_25,self=$StringScanner=$klass($base,$super,"StringScanner",$StringScanner),def=self.$$proto;[self].concat($parent_nesting)}return def.pos=def.string=def.working=def.matched=def.prev_pos=def.match=nil,self.$attr_reader("pos"),self.$attr_reader("matched"),Opal.defn(self,"$initialize",TMP_StringScanner_initialize_1=function(string){var self=this;return self.string=string,self.pos=0,self.matched=nil,self.working=string,self.match=[]},TMP_StringScanner_initialize_1.$$arity=1),self.$attr_reader("string"),Opal.defn(self,"$beginning_of_line?",TMP_StringScanner_beginning_of_line$q_2=function(){var self=this;return 0===self.pos||"\n"===self.string.charAt(self.pos-1)},TMP_StringScanner_beginning_of_line$q_2.$$arity=0),Opal.alias(self,"bol?","beginning_of_line?"),Opal.defn(self,"$scan",TMP_StringScanner_scan_3=function(pattern){var self=this;pattern=self.$anchor(pattern);var result=pattern.exec(self.working);return null==result?self.matched=nil:"object"==typeof result?(self.prev_pos=self.pos,self.pos+=result[0].length,self.working=self.working.substring(result[0].length),self.matched=result[0],self.match=result,result[0]):"string"==typeof result?(self.pos+=result.length,self.working=self.working.substring(result.length),result):nil},TMP_StringScanner_scan_3.$$arity=1),Opal.defn(self,"$scan_until",TMP_StringScanner_scan_until_4=function(pattern){var self=this;pattern=self.$anchor(pattern);for(var result,pos=self.pos,working=self.working;;){if(result=pattern.exec(working),pos+=1,working=working.substr(1),null!=result)return self.matched=self.string.substr(self.pos,pos-self.pos-1+result[0].length),self.prev_pos=pos-1,self.pos=pos,self.working=working.substr(result[0].length),self.matched;if(0===working.length)return self.matched=nil}},TMP_StringScanner_scan_until_4.$$arity=1),Opal.defn(self,"$[]",TMP_StringScanner_$$_5=function(idx){var self=this,match=self.match;return 0>idx&&(idx+=match.length),0>idx||idx>=match.length?nil:null==match[idx]?nil:match[idx]},TMP_StringScanner_$$_5.$$arity=1),Opal.defn(self,"$check",TMP_StringScanner_check_6=function(pattern){var self=this;pattern=self.$anchor(pattern);var result=pattern.exec(self.working);return self.matched=null==result?nil:result[0]},TMP_StringScanner_check_6.$$arity=1),Opal.defn(self,"$check_until",TMP_StringScanner_check_until_7=function(pattern){var self=this,prev_pos=self.prev_pos,pos=self.pos,result=self.$scan_until(pattern);return result!==nil&&(self.matched=result.substr(-1),self.working=self.string.substr(pos)),self.prev_pos=prev_pos,self.pos=pos,result},TMP_StringScanner_check_until_7.$$arity=1),Opal.defn(self,"$peek",TMP_StringScanner_peek_8=function(length){var self=this;return self.working.substring(0,length)},TMP_StringScanner_peek_8.$$arity=1),Opal.defn(self,"$eos?",TMP_StringScanner_eos$q_9=function(){var self=this;return 0===self.working.length},TMP_StringScanner_eos$q_9.$$arity=0),Opal.defn(self,"$exist?",TMP_StringScanner_exist$q_10=function(pattern){var self=this,result=pattern.exec(self.working);return null==result?nil:0==result.index?0:result.index+1},TMP_StringScanner_exist$q_10.$$arity=1),Opal.defn(self,"$skip",TMP_StringScanner_skip_11=function(pattern){var self=this;pattern=self.$anchor(pattern);var result=pattern.exec(self.working);if(null==result)return self.matched=nil;var match_str=result[0],match_len=match_str.length;return self.matched=match_str,self.prev_pos=self.pos,self.pos+=match_len,self.working=self.working.substring(match_len),match_len},TMP_StringScanner_skip_11.$$arity=1),Opal.defn(self,"$skip_until",TMP_StringScanner_skip_until_12=function(pattern){var self=this,result=self.$scan_until(pattern);return result===nil?nil:(self.matched=result.substr(-1),result.length)},TMP_StringScanner_skip_until_12.$$arity=1),Opal.defn(self,"$get_byte",TMP_StringScanner_get_byte_13=function(){var self=this,result=nil;return self.pos<self.string.length?(self.prev_pos=self.pos,self.pos+=1,result=self.matched=self.working.substring(0,1),self.working=self.working.substring(1)):self.matched=nil,result},TMP_StringScanner_get_byte_13.$$arity=0),Opal.alias(self,"getch","get_byte"),Opal.defn(self,"$match?",TMP_StringScanner_match$q_14=function(pattern){var self=this;pattern=self.$anchor(pattern);var result=pattern.exec(self.working);return null==result?nil:(self.prev_pos=self.pos,result[0].length)},TMP_StringScanner_match$q_14.$$arity=1),Opal.defn(self,"$pos=",TMP_StringScanner_pos$eq_15=function(pos){var self=this;return 0>pos&&(pos+=self.string.$length()),self.pos=pos,self.working=self.string.slice(pos)},TMP_StringScanner_pos$eq_15.$$arity=1),Opal.defn(self,"$matched_size",TMP_StringScanner_matched_size_16=function(){var self=this;return self.matched===nil?nil:self.matched.length},TMP_StringScanner_matched_size_16.$$arity=0),Opal.defn(self,"$post_match",TMP_StringScanner_post_match_17=function(){var self=this;return self.matched===nil?nil:self.string.substr(self.pos)},TMP_StringScanner_post_match_17.$$arity=0),Opal.defn(self,"$pre_match",TMP_StringScanner_pre_match_18=function(){var self=this;return self.matched===nil?nil:self.string.substr(0,self.prev_pos)},TMP_StringScanner_pre_match_18.$$arity=0),Opal.defn(self,"$reset",TMP_StringScanner_reset_19=function(){var self=this;return self.working=self.string,self.matched=nil,self.pos=0},TMP_StringScanner_reset_19.$$arity=0),Opal.defn(self,"$rest",TMP_StringScanner_rest_20=function(){var self=this;return self.working},TMP_StringScanner_rest_20.$$arity=0),Opal.defn(self,"$rest?",TMP_StringScanner_rest$q_21=function(){var self=this;return 0!==self.working.length},TMP_StringScanner_rest$q_21.$$arity=0),Opal.defn(self,"$rest_size",TMP_StringScanner_rest_size_22=function(){var self=this;return self.$rest().$size()},TMP_StringScanner_rest_size_22.$$arity=0),Opal.defn(self,"$terminate",TMP_StringScanner_terminate_23=function(){var self=this,$writer=nil;return self.match=nil,$writer=[self.string.$length()],$send(self,"pos=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)]},TMP_StringScanner_terminate_23.$$arity=0),Opal.defn(self,"$unscan",TMP_StringScanner_unscan_24=function(){var self=this;return self.pos=self.prev_pos,self.prev_pos=nil,self.match=nil,self},TMP_StringScanner_unscan_24.$$arity=0),self.$private(),Opal.defn(self,"$anchor",TMP_StringScanner_anchor_25=function(pattern){var flags=pattern.toString().match(/\/([^\/]+)$/);return flags=flags?flags[1]:void 0,new RegExp("^(?:"+pattern.source+")",flags)},TMP_StringScanner_anchor_25.$$arity=1),nil&&"anchor"}($nesting[0],null,$nesting)};